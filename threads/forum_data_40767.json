{"post_id":40767,"thread_id":40767,"title":"Long shot - Help with \"frozen\" SM0512F SSDs on MBP 2013 ?","user_id":1968,"username":"JonRussell","post_date":"2018-10-16 14:05:59","message":"Hi.\nFirst time here. Be gentle with me.\n:-)\n\ntl;dr:\nI have managed to \"freeze\" four! 512GB 2013 MBP SSDs (SM0512F) in the process of securely erasing them. I have tried everything to recover them, but they seem to be bricked. Can anyone here help ?\nI need to understand if its possible to unlock (remove the ATA security password) on an SSD. Currently they are not being recognised and do not appear as \/dev\/sda so I cant run hdparm on them.\nI get :\n\n[ 1.583978] ata1.00: ATA-8: APPLE SSD SM0512F, UXM2JA1Q, max UDMA\/133\n[ 1.583980] ata1.00: 977105060 sectors, multi 16: LBA48 NCQ (depth 31\/32), AA\n[ 1.584349] ata1.00: unexpected _GTF length (8)\n[ 1.584489] ata1.00: configured for UDMA\/133\n[ 32.844187] ata1.00: exception Emask 0x0 SAct 0x10000000 SErr 0x0 action 0x6 frozen\n[ 32.849387] ata1.00: failed command: READ FPDMA QUEUED\n[ 32.854540] ata1.00: cmd 60\/08:e0:00:00:00\/00:00:00:00:00\/40 tag 28 ncq dma 4096 in\n[ 32.864845] ata1.00: status: { DRDY }\n[ 32.866331] ata1: hard resetting link\n[snip]\n[ 75.292101] ata1: SATA link down (SStatus 0 SControl 320)\n[ 75.297256] ata1.00: disabled\n[ 75.312349] ata1: EH complete\n[ 75.369287] ata1.00: detaching (SCSI 0:0:0:0)\n\n\nFull version:\nI am responsible for recycling our old laptops at work. Everything older than 5 year gets recycled to staff and charities.\nI have a tried and tested wiping process for hard disks I've been using for 2 years on 100's of disks.\nI securely wipe the disks, then reinstall the OS and give the laptops away.\nFor laptops that are physically broken, I watch Louis's videos and fix them :-) or swap parts from even worse broken machines to make working Franken-machines.\n(Hi Louis - Thanks for your great content :cool:)\nFor standard 2.5\" HDDs & SDDs I wipe them in a dedicated machine I built, running Linux, with lots of drive bays.\nI run these ATA Erase commands wrapped in a script, that logs the output and sends me emails when its done :\n\n      hdparm -I \/dev\/sda\n\n      echo $'\\nStarting Secure Erase ...' \n      hdparm --user-master u --security-set-pass password \/dev\/sda\n      hdparm --user-master u --security-erase password \/dev\/sda\n      hdparm -z \/dev\/sda\n      lsblk\nor\n      echo $'\\nStarting Enhanced Secure Erase ...'\n      hdparm --user-master u --security-set-pass password \/dev\/$1\n      hdparm --user-master u --security-erase-enhanced password \/dev\/$1\n      hdparm -z \/dev\/sda \n      lsblk\n\nThe \"Enhanced\" Secure Erase is sometimes not supported on some SATA disks, hence I run one or the other.\n\nTo double check the erase has been successful, I then run :\n      sum \/dev\/sda\nand check it equals zero.\n\nThis works perfectly for all 2.5\" SSDs I've come across so far, until I started working on the 2013 MBP recently with the funny (custom Apple connector) SSDs SM0512F\n\nI bought a converter from the custom connector to a PCI slot, so I could fit the drives in my wiping machine.\nThe first drive ran the secure erase, but failed the checksum. Looking on the raw disk, the last block had some data, after the erase completed.\nSo I ran the enhanced erase and that failed the checksum too. Then I tried to manually dd the last block with zeros.\nThis hung during the dd. When I tried to access the drive after a reboot, I couldn't see the drive at all.\n\nI thought it might have something to do with the PCI adaptor. So I then tried it on a fresh MBP and booted in to Kali Linux from USB, so I could run the erase command locally on the Mac, rather than use a separate machine. I ran the same erase script, on two different laptops. (Mistake number 1)\nBoth of those hung during the enhanced secure erase process. When I rebooted the drives weren't visible and there were errors in the dmesg log.\nI then thought I'd try one last time (mistake number 2) on another fresh MBP, without the enhanced erase, just the standard secure erase.\nBut that hung too, making four \"frozen\" 512GB SSDs. !!\n:-(\n\nAfter I stopped crying I have now tried pretty much everything I can think of to recover the SSDs and I'm too scared to try another 2013 MBP until I know whats going wrong.\nI am assuming that because they all hung during one of the ATA Secure Erase commands, that they have been left with a Security Password set?\nI have booted a MBP in to network recovery and used the security utility to set the same firmware password, hoping that might unlock the disk, but that didn't work.\nWhen I run the Mojave installer from USB on the MBP, the Disk Utility cant see the SSD, so I cant erase it or partition it.\nI have tried installing them in a windows PC and trying to set\/clear the HDD password in the BIOS, but that didn't work.\nI have tried booting Kali on a PC with a working Apple SSD, then hot swapping a frozen SSD to see if I can send an unlock command, but that didn't work either.\n\nThis line from the log says \"frozen\" which leads me to think the disks have their security password still set ?\n\n      [ 32.844187] ata1.00: exception Emask 0x0 SAct 0x10000000 SErr 0x0 action 0x6 [B]frozen[\/B]\n\nI'm out of idea.\n\nThere's a good explanation of the Security Erase function on ATA hard disks here : [url]http:\/\/www.admin-magazine.com\/Archive\/2014\/19\/Using-the-ATA-security-features-of-modern-hard-disks-and-SSDs[\/url]\n\nCan anyone help me remove the security password on an Apple SSDs (SM0512F) ?\n\nDoes anyone know how these Apple SSDs differ in from a standard 2.5\" Apple SSD other than the custom connector. Do they have any special security features that stop them from being security erased ?\n\nRelevant dmesg log entries from Kali booting with a \"frozen\" drive :\n\n[ 0.000000] BIOS-e820: [mem 0x000000008ad62000-0x000000008ad8efff] ACPI data\n[ 0.000000] ACPI: SSDT 0x000000008AD7E000 00010B (v01 APPLE SataAhci 00001000 INTL 20100915)\n[ 0.000000] [Firmware Bug]: TSC_DEADLINE disabled due to Errata; please update microcode to version: 0x20 (or later)\n[ 0.000000] Memory: 16288716K\/16683600K available (10252K kernel code, 1210K rwdata, 3216K rodata, 1548K init, 656K bss, 394884K reserved, 0K cma-reserved)\n[ 1.088081] Write protecting the kernel read-only data: 16384k\n[ 1.245807] libata version 3.00 loaded.\n[ 1.269433] ata1: SATA max UDMA\/133 abar m8192@0xb0700000 port 0xb0700100 irq 16\n[ 1.583478] ata1: SATA link up 6.0 Gbps (SStatus 133 SControl 300)\n[ 1.583833] ata1.00: unexpected _GTF length (8)\n[ 1.583978] ata1.00: ATA-8: APPLE SSD SM0512F, UXM2JA1Q, max UDMA\/133\n[ 1.583980] ata1.00: 977105060 sectors, multi 16: LBA48 NCQ (depth 31\/32), AA\n[ 1.584349] ata1.00: unexpected _GTF length (8)\n[ 1.584489] ata1.00: configured for UDMA\/133\n[ 32.844187] ata1.00: exception Emask 0x0 SAct 0x10000000 SErr 0x0 action 0x6 [B]frozen[\/B]\n[ 32.849387] ata1.00: failed command: READ FPDMA QUEUED\n[ 32.854540] ata1.00: cmd 60\/08:e0:00:00:00\/00:00:00:00:00\/40 tag 28 ncq dma 4096 in\n[ 32.864845] ata1.00: status: { DRDY }\n[ 32.866331] ata1: hard resetting link\n[ 33.183864] ata1: SATA link up 6.0 Gbps (SStatus 133 SControl 300)\n[ 33.187186] ata1.00: unexpected _GTF length (8)\n[ 33.190564] ata1.00: unexpected _GTF length (8)\n[ 33.192688] ata1.00: configured for UDMA\/133\n[ 33.194585] ata1.00: device reported invalid CHS sector 0\n[ 33.196467] ata1: EH complete\n[ 63.836181] ata1.00: NCQ disabled due to excessive errors\n[ 63.841332] ata1.00: exception Emask 0x0 SAct 0x2 SErr 0x0 action 0x6 frozen\n[ 63.843922] ata1.00: failed command: READ FPDMA QUEUED\n[ 63.846489] ata1.00: cmd 60\/08:08:00:00:00\/00:00:00:00:00\/40 tag 1 ncq dma 4096 in\n[ 63.851622] ata1.00: status: { DRDY }\n[ 63.853135] ata1: hard resetting link\n[ 64.171779] ata1: SATA link up 6.0 Gbps (SStatus 133 SControl 300)\n[ 64.174478] ata1.00: unexpected _GTF length (8)\n[ 64.178036] ata1.00: unexpected _GTF length (8)\n[ 64.180225] ata1.00: configured for UDMA\/133\n[ 64.182284] ata1.00: device reported invalid CHS sector 0\n[ 64.184369] ata1: EH complete\n[ 64.217273] ata1: limiting SATA link speed to 3.0 Gbps\n[ 64.220262] ata1.00: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x6\n[ 64.223423] ata1.00: irq_stat 0x40000000\n[ 64.226554] ata1.00: failed command: READ DMA\n[ 64.229718] ata1.00: cmd c8\/00:08:00:00:00\/00:00:00:00:00\/e0 tag 2 dma 4096 in\n[ 64.232485] ata1.00: status: { DRDY ERR }\n[ 64.233785] ata1.00: error: { ABRT }\n[ 64.235067] ata1: hard resetting link\n[ 64.551906] ata1: SATA link down (SStatus 0 SControl 320)\n[ 69.596110] ata1: hard resetting link\n[ 69.916098] ata1: SATA link down (SStatus 0 SControl 320)\n[ 74.972103] ata1: hard resetting link\n[ 75.292101] ata1: SATA link down (SStatus 0 SControl 320)\n[ 75.297256] ata1.00: disabled\n[ 75.312349] ata1: EH complete\n[ 75.369287] ata1.00: detaching (SCSI 0:0:0:0)\n\n\n\nThanks !\n\nRegards,\n\nJon."}
{"post_id":41055,"thread_id":40767,"title":"Long shot - Help with \"frozen\" SM0512F SSDs on MBP 2013 ?","user_id":1968,"username":"JonRussell","post_date":"2018-10-22 13:34:43","message":"No worries. I knew it was a long shot. Just thought someone here would know. Looks like I bricked \u00a3600 worth of SSDs ! :-("}
{"post_id":41117,"thread_id":40767,"title":"Long shot - Help with \"frozen\" SM0512F SSDs on MBP 2013 ?","user_id":289,"username":"smiba","post_date":"2018-10-23 14:43:54","message":"Isn't the frozen setting set by using disk encryption? Not sure if all Apple SSDs have these set after using FileVault (Default on pretty much all models with a new version of OS X), might also be enforced by the BIOS.\n\nYou might get some luck by using the Parted Magic live CD ($11 one time purchase, $49 year subscription), this is one hell of a live CD bundled with a lot of different tools for HDD\/SSD management. You'll use this in the future as well for anything storage related (and its also a really neat linux live ISO which runs 100% from ram after boot).\n\nBooted in Parted Magic, use the \"Erase Disk\" option under Tools > Erase Disk (iirc), it might be able to unlock the device again and if its not one of the different tools might be of used.\nI just find it hard to believe these SSDs are all bricked beyond repair by a simple command, sounds like a disaster waiting to happen!"}
